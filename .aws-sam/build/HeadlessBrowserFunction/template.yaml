AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Description: Lambda function for headless browser automation and SQS integration

Metadata:
  AWS::Region: us-east-2 # Change this to your desired region, e.g., us-west-1

Resources:
  ResultQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: BrowserAutomationResultQueue
      VisibilityTimeout: 120

  HeadlessBrowserFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: lambda_function.lambda_handler
      Runtime: python3.12
      CodeUri: .
      MemorySize: 1024
      Timeout: 60
      Policies:
        - AWSLambdaBasicExecutionRole
        - Version: "2012-10-17"
          Statement:
            - Effect: Allow
              Action:
                - sqs:SendMessage
                - sqs:ReceiveMessage
                - sqs:DeleteMessage
                - sqs:GetQueueAttributes
              Resource: !GetAtt ResultQueue.Arn
      Environment:
        Variables:
          RESULT_QUEUE_URL: !Ref ResultQueue
      Events:
        SQSTrigger:
          Type: SQS
          Properties:
            Queue: !GetAtt ResultQueue.Arn
            BatchSize: 1

Outputs:
  LambdaFunctionName:
    Description: "Lambda Function Name"
    Value: !Ref HeadlessBrowserFunction
